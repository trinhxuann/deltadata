<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Various functions for acquiring data within the SFE • deltadata</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Various functions for acquiring data within the SFE">
<meta name="description" content="Workflow functions for IEP surveys to more efficiently work through the QAQC and publication process.">
<meta property="og:description" content="Workflow functions for IEP surveys to more efficiently work through the QAQC and publication process.">
<meta property="og:image" content="https://trinhxuann.github.io/deltadata/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">deltadata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="deltadata-">deltadata 
<a class="anchor" aria-label="anchor" href="#deltadata-"></a>
</h1>
</div>
<p><link rel="shortcut icon" type="image/x-icon" href="pkgdown/favicon/favicon.ico"></p>
<p>This package contains various workflow functions for working with data within the Sacramento-San Joaquin River Delta. There is a primary focus on IEP (Interagency Ecological Program) Surveys and supporting their data publication workflow. Additional features pertaining to other surveys may be supported in the future.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://trinhxuann.github.io/deltadata/">deltadata</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">#&gt; which was just loaded, will retire in October 2023.</span></span>
<span><span class="co">#&gt; Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">#&gt; It may be desirable to make the sf package available;</span></span>
<span><span class="co">#&gt; package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">#&gt; The sp package is now running under evolution status 2</span></span>
<span><span class="co">#&gt;      (status 2 uses the sf package in place of rgdal)</span></span></code></pre></div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The <code>deltadata</code> package can be installed from its GitHub repository.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install `devtools` if we need to</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Installing `deltadata` if we do not already have it</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"trinhxuann/deltadata"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reading-in-the-data">Reading in the data<a class="anchor" aria-label="anchor" href="#reading-in-the-data"></a>
</h2>
<p>The <code><a href="reference/bridgeAccess.html">bridgeAccess()</a></code> function can be used to connect to an Access database and extract tables of interest. First and foremost, we must ensure that the architecture of our R is the same as our Microsoft Access (32 vs 64-bit). The function will check this for us and provide an interpretable error if they do not match. For most state computers, we have 32-bit Microsoft Access which means that we must have 32-bit R for this function to work. The newest version of R that supports 32-bit is <a href="https://cran.r-project.org/bin/windows/base/old/4.1.3" class="external-link">4.1.3</a> (newer versions of R no longer support the 32-bit architecture, so this is not ideal). Once that is satisfied, we can work in 64-bit R and 32-bit R will be invoked when appropriate. If installing 32-bit R is not an option, 64-bit Microsoft Access must be installed to use this function with 64-bit R. Basically, the architecture of R must match that of Microsoft Access, and if that is satisfied, the function can run.</p>
<p>The function can connect directly to a URL source or to a file on our hard drive. When connecting to a URL, it is suggested to download from a zipped source to minimize the file size–the function will extract the Access file from the zipped file. If we then only provide the file path in the function, a lost of available tables will be provided to us to explore. The function can also access system tables, however, we will be prompted to provide file permissions before the function can pull those tables. As a case study, we will work with the SLS Survey:</p>
<p>First, download the database (zipped form) and explore what tables are available to extract–the database file will only be downloaded once as long as we remain in the same R session (downloaded to the temporary folder):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/bridgeAccess.html">bridgeAccess</a></span><span class="op">(</span><span class="st">"https://filelib.wildlife.ca.gov/Public/Delta%20Smelt/SLS.zip"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Extracting file: 'SLS.mdb' from the zip file.</span></span>
<span><span class="co">#&gt; Specify at least one table to pull from: </span></span>
<span><span class="co">#&gt;  [1] "MSysAccessObjects"          "MSysACEs"                  </span></span>
<span><span class="co">#&gt;  [3] "MSysNameMap"                "MSysNavPaneGroupCategories"</span></span>
<span><span class="co">#&gt;  [5] "MSysNavPaneGroups"          "MSysNavPaneGroupToObjects" </span></span>
<span><span class="co">#&gt;  [7] "MSysNavPaneObjectIDs"       "MSysObjects"               </span></span>
<span><span class="co">#&gt;  [9] "MSysQueries"                "MSysRelationships"         </span></span>
<span><span class="co">#&gt; [11] "Catch"                      "FishCodes"                 </span></span>
<span><span class="co">#&gt; [13] "Lengths"                    "Meter Corrections"         </span></span>
<span><span class="co">#&gt; [15] "SLS Stations"               "Tow Info"                  </span></span>
<span><span class="co">#&gt; [17] "Water Info"</span></span></code></pre></div>
<p>SLS has 7 main relational tables of interest:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slsTables</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bridgeAccess.html">bridgeAccess</a></span><span class="op">(</span><span class="st">"https://filelib.wildlife.ca.gov/Public/Delta%20Smelt/SLS.zip"</span>,</span>
<span>                          tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Catch"</span>, <span class="st">"FishCodes"</span>, <span class="st">"Lengths"</span>, <span class="st">"Meter Corrections"</span>,</span>
<span>                                     <span class="st">"SLS Stations"</span>, <span class="st">"Tow Info"</span>, <span class="st">"Water Info"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can also download the relationship table. This is an important table that records the relationships between the relational tables. Unfortunately, this table does require special permissions; but fortunately, we can easily give ourselves the necessary permission. When we first try to pull the table, an error is given and the Access file will be opened. The function will then output in the console’s error message instructions on how to give ourselves permissions: in the program, “Enable content, <code>Ctrl + g</code>, enter <code>CurrentProject.Connection.Execute "GRANT SELECT ON MSysRelationships TO Admin;"</code>, <code>Enter</code>, exit file, and rerun this code.”</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/bridgeAccess.html">bridgeAccess</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://filelib.wildlife.ca.gov/Public/Delta%20Smelt/SLS.zip"</span>,</span>
<span>  tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MSysRelationships"</span><span class="op">)</span>, retry <span class="op">=</span> <span class="cn">T</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; You are asking for a system table but do not have permissions. Opening the database file to allow you to do so.</span></span>
<span><span class="co">#&gt; Enable content, `Ctrl + g`, enter `CurrentProject.Connection.Execute "GRANT SELECT ON MSysRelationships TO Admin;"`, `Enter`. Will retry once after 25 seconds.</span></span>
<span><span class="co">#&gt; Retrying...</span></span>
<span></span>
<span><span class="co"># The function outputs a list, of which we can index to grab just the table</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="va">schema</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-joining">Data joining<a class="anchor" aria-label="anchor" href="#data-joining"></a>
</h2>
<p>The schema table contains instructions on how to join our relational tables together. The <code><a href="reference/schemaJoin.html">schemaJoin()</a></code> function deciphers this table and does the joining for us. This approach is theoretically preferable compared to joining by hand as it removes any guesswork on how we should join the tables together–this is not absolute though, since it depends on the database being set up correctly in the first place.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">joinedData</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/schemaJoin.html">schemaJoin</a></span><span class="op">(</span><span class="va">schema</span>, <span class="va">slsTables</span><span class="op">)</span></span>
<span><span class="co">#&gt; inner_join 'Catch' with 'Lengths' via columns 'Date' 'Station' 'Tow' 'FishCode' and 'Date' 'Station' 'Tow' 'FishCode' </span></span>
<span><span class="co">#&gt; inner_join 'Catch' with 'Tow Info' via columns 'Date' 'Station' 'Tow' and 'Date' 'Station' 'Tow' </span></span>
<span><span class="co">#&gt; inner_join 'Tow Info' with 'Water Info' via columns 'Date' 'Station' and 'Date' 'Station'</span></span></code></pre></div>
<p>Throughout the joining process, the function provides a narration of the join type, the two relational tables being joined, and the column keys the join is occurring on. We can use this narration to ensure that we are getting the joins we are expecting. If these are not the joins that we want, the function can take in any schema table, i.e., we can modify what join type(s) we would like the function to use by specifying the <code>joinType</code> column in the schema table. The four join options are: <code>full_join</code>, <code>inner_join</code>, <code>left_join</code>, and <code>right_join</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schemaFullJoin</span> <span class="op">&lt;-</span> <span class="va">schema</span></span>
<span><span class="va">schemaFullJoin</span><span class="op">$</span><span class="va">joinType</span> <span class="op">&lt;-</span> <span class="st">"full_join"</span></span>
<span><span class="va">joinedDataFullJoin</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/schemaJoin.html">schemaJoin</a></span><span class="op">(</span><span class="va">schemaFullJoin</span>, <span class="va">slsTables</span><span class="op">)</span></span>
<span><span class="co">#&gt; full_join 'Catch' with 'Lengths' via columns 'Date' 'Station' 'Tow' 'FishCode' and 'Date' 'Station' 'Tow' 'FishCode' </span></span>
<span><span class="co">#&gt; full_join 'Catch' with 'Tow Info' via columns 'Date' 'Station' 'Tow' and 'Date' 'Station' 'Tow' </span></span>
<span><span class="co">#&gt; full_join 'Tow Info' with 'Water Info' via columns 'Date' 'Station' and 'Date' 'Station'</span></span>
<span></span>
<span><span class="co"># Would expect number of rows to differ between an inner vs full join</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>joinType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"fullJoin"</span><span class="op">)</span>,</span>
<span>           nRows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">joinedData</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">joinedDataFullJoin</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           nCols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">joinedData</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">joinedDataFullJoin</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   joinType  nRows nCols</span></span>
<span><span class="co">#&gt; 1     auto 195473    33</span></span>
<span><span class="co">#&gt; 2 fullJoin 195648    33</span></span></code></pre></div>
<div class="section level3">
<h3 id="aside-on-schemajoin">Aside on <code>schemaJoin()</code>
<a class="anchor" aria-label="anchor" href="#aside-on-schemajoin"></a>
</h3>
<p>Besides supplying our own join type to the schema table, we can also provide manipulated relational tables to the function, e.g., tables in <code>slsTables</code> in the example above. There are several reasons why this may be required: 1) we want to be sure our columns are read in correctly, e.g., date data as a Date format, 2) column names need to change, 3) unit conversion, or 4) other reasons. Ultimately, this function simply looks at the schema table and applies those joins to the provided data–we can manipulate either argument as we like.</p>
</div>
</div>
<div class="section level2">
<h2 id="checking-gps-coordinate-outliers">Checking GPS coordinate outliers<a class="anchor" aria-label="anchor" href="#checking-gps-coordinate-outliers"></a>
</h2>
<p>Two functions are dedicated to checking outlying GPS coordinates:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="reference/plotGPS.html">plotGPS()</a></code>: plots sampling GPS coordinates on a leaflet map. Requires a data frame with 6 columns, <code>date</code>, <code>station</code>, <code>legend</code>, <code>layer</code>, <code>lat</code>, and <code>lon.</code> The <code>legend</code> column determines the color labels for the plotted points, and it is recommended that one group be the theoretical coordinates of each sampling station. The <code>layer</code> column determines the layer control of the output map and is generally the survey number. See <code>?plotGPS()</code> for more information.</li>
<li>
<code><a href="reference/gpsOutlier.html">gpsOutlier()</a></code>: returns a data frame of GPS coordinates that are beyond a specified distance (default is 0.5 mile, measured “as-the-crow-flies”, or the most direct path, that takes into account the curvature of the Earth) from each point’s theoretical coordinates. This function also requires a data frame with 6 columns, the same as <code><a href="reference/plotGPS.html">plotGPS()</a></code>, with a firm requirement for a <code>Theoretical</code> (named as so) group of GPS coordinates labeled in <code>legend</code> column.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gpsDF</span> <span class="op">&lt;-</span> <span class="va">slsTables</span><span class="op">[[</span><span class="st">"Water Info"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">gpsDF</span><span class="op">$</span><span class="va">SeasonYear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">gpsDF</span><span class="op">$</span><span class="va">Date</span>, format <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">gpsDF</span><span class="op">$</span><span class="va">Date</span>, format <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">11</span><span class="op">)</span></span>
<span><span class="va">gpsDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">gpsDF</span>, <span class="va">SeasonYear</span> <span class="op">==</span> <span class="fl">2023</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Split lat/lon into degrees</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"StartLat"</span>, <span class="st">"StartLong"</span>, <span class="st">"EndLat"</span>, <span class="st">"EndLong"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gpsDF</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[-. ]"</span>, <span class="st">""</span>, <span class="va">gpsDF</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Creating a function to do this since we'll be reusing it later:</span></span>
<span><span class="va">createGPS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">StartLatD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">StartLat</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">StartLatM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">StartLat</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">StartLatS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">StartLat</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">EndLatD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">EndLat</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">EndLatM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">EndLat</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">EndLatS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">EndLat</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">StartLonD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">StartLong</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">StartLonM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">StartLong</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">StartLonS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">StartLong</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">EndLonD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">EndLong</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">EndLonM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">EndLong</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">EndLonS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">EndLong</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Note the seconds calculation here. 36000 due to format of the LatS columns</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">Start_lat</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">StartLatD</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">StartLatM</span><span class="op">/</span><span class="fl">60</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">StartLatS</span><span class="op">/</span><span class="fl">36000</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">End_lat</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">EndLatD</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">EndLatM</span><span class="op">/</span><span class="fl">60</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">EndLatS</span><span class="op">/</span><span class="fl">36000</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">Start_lon</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">StartLonD</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">StartLonM</span><span class="op">/</span><span class="fl">60</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">StartLonS</span><span class="op">/</span><span class="fl">36000</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">End_lon</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">EndLonD</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">EndLonM</span><span class="op">/</span><span class="fl">60</span> <span class="op">+</span> <span class="va">data</span><span class="op">$</span><span class="va">EndLonS</span><span class="op">/</span><span class="fl">36000</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">data</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">gpsDF</span> <span class="op">&lt;-</span> <span class="fu">createGPS</span><span class="op">(</span><span class="va">gpsDF</span><span class="op">)</span></span>
<span><span class="co"># Required columns for plotGPS()</span></span>
<span><span class="va">gpsDF</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="va">gpsDF</span><span class="op">$</span><span class="va">SeasonYear</span></span>
<span><span class="va">gpsDF</span><span class="op">$</span><span class="va">layer</span> <span class="op">&lt;-</span> <span class="va">gpsDF</span><span class="op">$</span><span class="va">Survey</span></span>
<span></span>
<span><span class="co"># GPS start coordinates</span></span>
<span><span class="va">gpsLat</span><span class="op">&lt;-</span> <span class="va">gpsDF</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gpsDF</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Start_lon"</span>, <span class="st">"End_lon"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">gpsLat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="va">gpsLat</span>, direction <span class="op">=</span> <span class="st">"long"</span>,</span>
<span>                        varying <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Start_lat"</span>, <span class="st">"End_lat"</span><span class="op">)</span>,</span>
<span>                        v.names <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>                        times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Start"</span>, <span class="st">"End"</span><span class="op">)</span>,</span>
<span>                        timevar <span class="op">=</span> <span class="st">"legend"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gpsLon</span><span class="op">&lt;-</span> <span class="va">gpsDF</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gpsDF</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Start_lat"</span>, <span class="st">"End_lat"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">gpsLon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="va">gpsLon</span>, direction <span class="op">=</span> <span class="st">"long"</span>,</span>
<span>                  varying <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Start_lon"</span>, <span class="st">"End_lon"</span><span class="op">)</span>,</span>
<span>                  v.names <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>                  times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Start"</span>, <span class="st">"End"</span><span class="op">)</span>,</span>
<span>                  timevar <span class="op">=</span> <span class="st">"legend"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gpsDFLong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">gpsLat</span>, lon <span class="op">=</span> <span class="va">gpsLon</span><span class="op">$</span><span class="va">lon</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Joining in the theoretical coordinates</span></span>
<span><span class="va">gpsTheoretical</span> <span class="op">&lt;-</span> <span class="va">slsTables</span><span class="op">$</span><span class="va">`SLS Stations`</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LatD"</span>, <span class="st">"LatM"</span>, <span class="st">"LatS"</span>, <span class="st">"LonD"</span>, <span class="st">"LonM"</span>, <span class="st">"LonS"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gpsTheoretical</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">gpsTheoretical</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">LatD</span> <span class="op">+</span> <span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">LatM</span><span class="op">/</span><span class="fl">60</span> <span class="op">+</span> </span>
<span>  <span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">LatS</span><span class="op">/</span><span class="fl">3600</span></span>
<span><span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="op">(</span><span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">LonD</span> <span class="op">+</span> <span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">LonM</span><span class="op">/</span><span class="fl">60</span> <span class="op">+</span> </span>
<span>                          <span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">LonS</span><span class="op">/</span><span class="fl">3600</span><span class="op">)</span></span>
<span><span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">legend</span> <span class="op">&lt;-</span> <span class="st">"Theoretical"</span></span>
<span><span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">layer</span> <span class="op">&lt;-</span> <span class="st">"Theoretical"</span></span>
<span><span class="va">gpsTheoretical</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">gpsData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">gpsDFLong</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"Station"</span>, <span class="st">"legend"</span>, <span class="st">"layer"</span>, <span class="st">"lat"</span>, </span>
<span>                               <span class="st">"lon"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                 <span class="va">gpsTheoretical</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"Station"</span>, <span class="st">"legend"</span>, <span class="st">"layer"</span>, <span class="st">"lat"</span>, </span>
<span>                                    <span class="st">"lon"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Can leave the NAs in, but plotGPS will throw back warnings about them</span></span>
<span><span class="va">gpsData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">gpsData</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># layerName and dateName are specific to the popup labels at each point.</span></span>
<span><span class="fu"><a href="reference/plotGPS.html">plotGPS</a></span><span class="op">(</span><span class="va">gpsData</span>, layerName <span class="op">=</span> <span class="st">"Survey"</span>, dateName <span class="op">=</span> <span class="st">"Year"</span>, height <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png"><!-- --></p>
<p><code><a href="reference/plotGPS.html">plotGPS()</a></code> allows us to quickly visualize our GPS coordinates. It is most useful when we also visualize the theoretical coordinates alongside our points of interest. The outputted leaflet map has several useful features: 1) an interactive map in which we can zoom in and out and move around, 2) a legend if we have multiple groupings of the same sampling location, 3) layer controls that allow us to see only the layers we want, and 4) labeled GPS point that also provides additional data when clicked upon. The function allows us to quickly see the most egregious outliers.</p>
<p>We can also do a finer search for outliers using <code><a href="reference/gpsOutlier.html">gpsOutlier()</a></code>. This function calculates the distance between each sampling point and that location’s theoretical GPS coordinates and returns any points that exceeds the distance threshold (defaults to 0.5 mile). This implies that we must supply the theoretical GPS coordinates of our sampling points to the function and is why it is recommended to construct our GPS data frame to include the theoretical when using <code><a href="reference/plotGPS.html">plotGPS()</a></code>. The data frame output for <code><a href="reference/gpsOutlier.html">gpsOutlier()</a></code> is the same format as required by <code><a href="reference/plotGPS.html">plotGPS()</a></code>, allowing us to pipe the two together.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># By default, d = 0.5</span></span>
<span><span class="va">gpsOutliersData</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gpsOutlier.html">gpsOutlier</a></span><span class="op">(</span><span class="va">gpsData</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/plotGPS.html">plotGPS</a></span><span class="op">(</span><span class="va">gpsOutliersData</span>, height <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png"><!-- --></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gpsOutliersData</span><span class="op">)</span></span>
<span><span class="co">#&gt;           date Station legend layer      lat       lon lonTheoretical</span></span>
<span><span class="co">#&gt; 413.End   2023     723    End     6 38.69222 -121.6719      -121.6731</span></span>
<span><span class="co">#&gt; 389.End   2023     330    End     5 38.01586 -122.3822      -122.3282</span></span>
<span><span class="co">#&gt; 389.Start 2023     330  Start     5 38.02122 -122.3821      -122.3282</span></span>
<span><span class="co">#&gt; 130.End   2023     336    End     1 38.05789 -122.3248      -122.2780</span></span>
<span><span class="co">#&gt; 130.Start 2023     336  Start     1 38.05925 -122.3032      -122.2780</span></span>
<span><span class="co">#&gt; 127.End   2023     329    End     1 38.06406 -122.3238      -122.3040</span></span>
<span><span class="co">#&gt;           latTheoretical  distance outlier</span></span>
<span><span class="co">#&gt; 413.End         38.23725 31.382077    TRUE</span></span>
<span><span class="co">#&gt; 389.End         38.02853  3.075955    TRUE</span></span>
<span><span class="co">#&gt; 389.Start       38.02853  2.987429    TRUE</span></span>
<span><span class="co">#&gt; 130.End         38.06111  2.560575    TRUE</span></span>
<span><span class="co">#&gt; 130.Start       38.06111  1.378380    TRUE</span></span>
<span><span class="co">#&gt; 127.End         38.06361  1.078905    TRUE</span></span></code></pre></div>
<p>The outputted data frame from <code><a href="reference/gpsOutlier.html">gpsOutlier()</a></code> will feature an <code>outlier</code> column alongside the distance from the theoretical point as <code>distance</code>. The default distance threshold of 0.5 mile is the ideal target for most CDFW survey trawls.</p>
</div>
<div class="section level2">
<h2 id="comparing-water-quality-values-to-cdec-gages">Comparing water quality values to CDEC gages<a class="anchor" aria-label="anchor" href="#comparing-water-quality-values-to-cdec-gages"></a>
</h2>
<p><code><a href="reference/popCDEC.html">popCDEC()</a></code> is used to populate a data frame of sampling points with water temperature, water turbidity, or water electroconductivity data from the nearest CDEC gage. Only these metrics are currently supported. The input data frame requires at least five columns: 1) <code>station</code> (name of the sampling point), 2) <code>lat</code> (latitude of the sampling point), 3) <code>lon</code> (longitude of the sampling point), 4) <code>time</code> (date-time of the sample), and 5) the water quality variable of interest (<code>temp</code>, <code>ec</code>, or <code>turbidity</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the joined SLS data as an example</span></span>
<span><span class="va">waterQualityData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">joinedData</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">Date</span>, format <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span> <span class="op">==</span> <span class="st">"2023"</span> <span class="op">&amp;</span></span>
<span>    <span class="va">Survey</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">StartLat</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">StartLong</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Split lat/lon into degrees</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"StartLat"</span>, <span class="st">"StartLong"</span>, <span class="st">"EndLat"</span>, <span class="st">"EndLong"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">waterQualityData</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[-. ]"</span>, <span class="st">""</span>, <span class="va">waterQualityData</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># createGPS is a helper function defined on line 108 above.</span></span>
<span><span class="va">waterQualityData</span> <span class="op">&lt;-</span> <span class="fu">createGPS</span><span class="op">(</span><span class="va">waterQualityData</span><span class="op">)</span></span>
<span><span class="va">waterQualityData</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="va">waterQualityData</span><span class="op">$</span><span class="va">Date</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">waterQualityData</span><span class="op">$</span><span class="va">Time</span>, format <span class="op">=</span> <span class="st">"%H:%M:%S"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">waterQualityData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">waterQualityData</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Station"</span>, <span class="st">"Start_lat"</span>, </span>
<span>                                                <span class="st">"Start_lon"</span>, <span class="st">"time"</span>,</span>
<span>                                                <span class="st">"TopTemp"</span>, <span class="st">"TopEC"</span>, <span class="st">"NTU"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">waterQualityData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">waterQualityData</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">waterQualityData</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">waterQualityData</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Station"</span>, <span class="st">"lat"</span>, <span class="st">"lon"</span>, <span class="st">"time"</span>, </span>
<span>                             <span class="st">"temp"</span>, <span class="st">"ec"</span>, <span class="st">"turbidity"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdecTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/popCDEC.html">popCDEC</a></span><span class="op">(</span><span class="va">waterQualityData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cdecTable</span><span class="op">)</span></span>
<span><span class="co">#&gt;   station      lat       lon                time cdecStation temp tempCDEC</span></span>
<span><span class="co">#&gt; 1     306 38.00064 -122.4145 2023-01-03 11:36:00         MRZ 10.4 9.555556</span></span>
<span><span class="co">#&gt; 2     308 38.01542 -122.4095 2023-01-03 11:14:00         MRZ 10.5 9.555556</span></span>
<span><span class="co">#&gt; 3     311 38.02083 -122.3827 2023-01-03 12:01:00         MRZ 10.1 9.555556</span></span>
<span><span class="co">#&gt; 4     315 38.03833 -122.3926 2023-01-03 10:52:00         MRZ 10.2 9.555556</span></span>
<span><span class="co">#&gt; 5     322 38.02550 -122.3524 2023-01-03 12:27:00         MRZ 10.1 9.555556</span></span>
<span><span class="co">#&gt; 6     323 38.03958 -122.2944 2023-01-03 13:14:00         MRZ 10.0 9.500000</span></span>
<span><span class="co">#&gt;   timeDifference  distance sensorNumber         sensorDescription units</span></span>
<span><span class="co">#&gt; 1         9 mins 15.067258           25 TEMPERATURE, WATER, DEG F DEG C</span></span>
<span><span class="co">#&gt; 2        31 mins 14.700119           25 TEMPERATURE, WATER, DEG F DEG C</span></span>
<span><span class="co">#&gt; 3         1 mins 13.222769           25 TEMPERATURE, WATER, DEG F DEG C</span></span>
<span><span class="co">#&gt; 4        53 mins 13.772100           25 TEMPERATURE, WATER, DEG F DEG C</span></span>
<span><span class="co">#&gt; 5         3 mins 11.561585           25 TEMPERATURE, WATER, DEG F DEG C</span></span>
<span><span class="co">#&gt; 6         1 mins  8.437388           25 TEMPERATURE, WATER, DEG F DEG C</span></span>
<span><span class="co">#&gt;   duration         dataAvailable</span></span>
<span><span class="co">#&gt; 1    event 08/21/2008 to present</span></span>
<span><span class="co">#&gt; 2    event 08/21/2008 to present</span></span>
<span><span class="co">#&gt; 3    event 08/21/2008 to present</span></span>
<span><span class="co">#&gt; 4    event 08/21/2008 to present</span></span>
<span><span class="co">#&gt; 5    event 08/21/2008 to present</span></span>
<span><span class="co">#&gt; 6    event 08/21/2008 to present</span></span></code></pre></div>
<p>For each sampling point, the function will return the desired water quality data from the nearest CDEC station for each sampling point, in terms of space (as-the-crow-flies) and time. The function also reports back various metadata: the nearest CDEC station (<code>cdecStation</code>), the time difference in minutes between the sample of interest and the CDEC sample (<code>timeDifference</code>), the distance in miles between the sampling point and the CDEC station (<code>distance</code>), and other metadata information about the CDEC station (<code>sensorNumber</code>, <code>sensorDescription</code>, <code>units</code>, <code>duration</code>, <code>dataAvailable</code>).</p>
<div class="section level3">
<h3 id="notes-on-the-nuanced-operations-by-popcdec">Notes on the nuanced operations by <code>popCDEC()</code>
<a class="anchor" aria-label="anchor" href="#notes-on-the-nuanced-operations-by-popcdec"></a>
</h3>
<p>There are several underlying operations of the function to be aware of:</p>
<ol style="list-style-type: decimal">
<li>the nearest CDEC station is calculated based on as-the-crow-flies distance</li>
<li>the reported value from the CDEC station is the closest time point to the requested sampling point that has data. This means that all <code>NA</code> data from the CDEC station is ignored, even sampling points that are closer in time to our sample. The reported value is the closest <em>valid</em> value in time to when our sampling occurred.</li>
<li>the function scrapes from the CDEC website and can get bogged down as we increase the number of data points to populate and/or the range of dates of the initial dataset. It is also dependent on the internet connection speed to the CDEC website</li>
<li>if multiple sampling points of interest is provided, the absolute date range of the dataset will be used to download data from each CDEC station of interest. This is very nuanced and can be safely ignored in most instances.</li>
</ol>
</div>
<div class="section level3">
<h3 id="pullcdec">
<code>pullCDEC</code><a class="anchor" aria-label="anchor" href="#pullcdec"></a>
</h3>
<p>Function <code>popCDEC</code> relies on <code><a href="reference/pullCDEC.html">pullCDEC()</a></code> in the background to pull data from CDEC gages. This function can be used as a stand-alone function to obtain data from any CDEC station. Since it is difficult to remember what data is available for each CDEC station, the function is constructed to guide us through selecting all necessary arguments if we do not know exactly what we want. To begin, we can provide the function with just the station name:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/pullCDEC.html">pullCDEC</a></span><span class="op">(</span>station <span class="op">=</span> <span class="st">"MAL"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 33 x 7</span></span>
<span><span class="co">#&gt;    sensorDescription                     sensorNumber duration plot      </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                        &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;     </span></span>
<span><span class="co">#&gt;  1 RIVER STAGE, FEET                                1 event    (RIV STG) </span></span>
<span><span class="co">#&gt;  2 RIVER STAGE, FEET                                1 hourly   (RIV STG) </span></span>
<span><span class="co">#&gt;  3 TEMPERATURE, AIR, DEG F                          4 event    (TEMP)    </span></span>
<span><span class="co">#&gt;  4 TEMPERATURE, AIR, DEG F                          4 hourly   (TEMP)    </span></span>
<span><span class="co">#&gt;  5 ELECTRICAL CONDUCTIVTY MILLI S, mS/cm            5 daily    (EL CND)  </span></span>
<span><span class="co">#&gt;  6 ELECTRICAL CONDUCTIVTY MILLI S, mS/cm            5 hourly   (EL CND)  </span></span>
<span><span class="co">#&gt;  7 WIND, SPEED, MPH                                 9 event    (WIND SP) </span></span>
<span><span class="co">#&gt;  8 WIND, SPEED, MPH                                 9 hourly   (WIND SP) </span></span>
<span><span class="co">#&gt;  9 WIND, DIRECTION, DEG                            10 event    (WIND DR) </span></span>
<span><span class="co">#&gt; 10 WIND, DIRECTION, DEG                            10 hourly   (WIND DR) </span></span>
<span><span class="co">#&gt; 11 BATTERY VOLTAGE, VOLTS                          14 event    (BAT VOL) </span></span>
<span><span class="co">#&gt; 12 BATTERY VOLTAGE, VOLTS                          14 hourly   (BAT VOL) </span></span>
<span><span class="co">#&gt; 13 FLOW, RIVER DISCHARGE, CFS                      20 event    (FLOW)    </span></span>
<span><span class="co">#&gt; 14 WATER, VELOCITY, FT/SEC                         21 event    (VLOCITY) </span></span>
<span><span class="co">#&gt; 15 TEMPERATURE, WATER, DEG F                       25 event    (TEMP W)  </span></span>
<span><span class="co">#&gt; 16 TEMPERATURE, WATER, DEG F                       25 hourly   (TEMP W)  </span></span>
<span><span class="co">#&gt; 17 SOLAR RADIATION, W/M^2                          26 event    (SOLAR R) </span></span>
<span><span class="co">#&gt; 18 SOLAR RADIATION, W/M^2                          26 hourly   (SOLAR R) </span></span>
<span><span class="co">#&gt; 19 WATER, TURBIDITY,   NTU                         27 event    (TURB W)  </span></span>
<span><span class="co">#&gt; 20 WATER, TURBIDITY,   NTU                         27 hourly   (TURB W)  </span></span>
<span><span class="co">#&gt; 21 CHLOROPHYLL, ug/L                               28 event    (CHLORPH) </span></span>
<span><span class="co">#&gt; 22 CHLOROPHYLL, ug/L                               28 hourly   (CHLORPH) </span></span>
<span><span class="co">#&gt; 23 WATER, DISSOLVED OXYGEN,  MG/L                  61 event    (DIS OXY) </span></span>
<span><span class="co">#&gt; 24 WATER, DISSOLVED OXYGEN,  MG/L                  61 hourly   (DIS OXY) </span></span>
<span><span class="co">#&gt; 25 WATER, PH VALUE, PH                             62 event    (PH VAL)  </span></span>
<span><span class="co">#&gt; 26 WATER, PH VALUE, PH                             62 hourly   (PH VAL)  </span></span>
<span><span class="co">#&gt; 27 ELECTRICAL COND BOTTOM MILLI S, mS/cm           92 hourly   (EL CONDB)</span></span>
<span><span class="co">#&gt; 28 ELECTRICAL CONDUCTIVTY MICRO S, uS/cm          100 daily    (EL COND) </span></span>
<span><span class="co">#&gt; 29 ELECTRICAL CONDUCTIVTY MICRO S, uS/cm          100 event    (EL COND) </span></span>
<span><span class="co">#&gt; 30 ELECTRICAL CONDUCTIVTY MICRO S, uS/cm          100 hourly   (EL COND) </span></span>
<span><span class="co">#&gt; 31 ELECTRICAL COND BOTTOM MICRO S, uS/cm          102 event    (EL CONDB)</span></span>
<span><span class="co">#&gt; 32 ELECTRICAL COND BOTTOM MICRO S, uS/cm          102 hourly   (EL CONDB)</span></span>
<span><span class="co">#&gt; 33 RIVER STAGE NAVD88, FEET                       141 hourly   (RIVST88) </span></span>
<span><span class="co">#&gt;    dataCollection    dataAvailable            gage </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;             &lt;chr&gt;                    &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt;  2 SATELLITE         10/01/1987 to present    MAL  </span></span>
<span><span class="co">#&gt;  3 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt;  4 SATELLITE         01/25/2008 to present    MAL  </span></span>
<span><span class="co">#&gt;  5 COMPUTED          10/01/1995 to 01/17/2008 MAL  </span></span>
<span><span class="co">#&gt;  6 MICROWAVE         01/01/1984 to 01/17/2008 MAL  </span></span>
<span><span class="co">#&gt;  7 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt;  8 SATELLITE         01/22/2008 to present    MAL  </span></span>
<span><span class="co">#&gt;  9 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 10 SATELLITE         01/22/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 11 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 12 SATELLITE         01/01/1995 to 10/01/2008 MAL  </span></span>
<span><span class="co">#&gt; 13 DATA XCHG-USGS    07/08/2011 to present    MAL  </span></span>
<span><span class="co">#&gt; 14 DATA XCHG-USGS    07/08/2011 to present    MAL  </span></span>
<span><span class="co">#&gt; 15 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 16 SATELLITE         06/13/1986 to present    MAL  </span></span>
<span><span class="co">#&gt; 17 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 18 SATELLITE         01/25/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 19 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 20 SATELLITE         01/17/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 21 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 22 SATELLITE         06/13/1986 to present    MAL  </span></span>
<span><span class="co">#&gt; 23 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 24 SATELLITE         06/18/2007 to present    MAL  </span></span>
<span><span class="co">#&gt; 25 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 26 SATELLITE         01/17/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 27 MICROWAVE         02/01/1995 to 01/17/2008 MAL  </span></span>
<span><span class="co">#&gt; 28 COMPUTED          01/18/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 29 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 30 SATELLITE         01/17/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 31 DATA XCHG-DWR DES 10/03/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 32 SATELLITE         01/17/2008 to present    MAL  </span></span>
<span><span class="co">#&gt; 33 COMPUTED          02/02/2006 to 09/30/2006 MAL</span></span>
<span><span class="co">#&gt; Please provide sensor # and duration</span></span></code></pre></div>
<p>The function provides us with the most current available metadata for station <code>MAL</code> from which we can specify our arguments. Here, we will skip to specifying all required arguments, but the function can take smaller steps, e.g., if we provide just sensor number and duration, the function filters for those options and provide the associated date range.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">malGage</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/pullCDEC.html">pullCDEC</a></span><span class="op">(</span>station <span class="op">=</span> <span class="st">"MAL"</span>, sensor <span class="op">=</span> <span class="fl">25</span>, duration <span class="op">=</span> <span class="st">"hourly"</span>, </span>
<span>                    dateStart <span class="op">=</span> <span class="st">"06/13/1986"</span>, dateEnd <span class="op">=</span> <span class="st">"06/14/1986"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">malGage</span><span class="op">)</span></span>
<span><span class="co">#&gt;   stationId duration sensorNumber sensorType            dateTime    obsDate</span></span>
<span><span class="co">#&gt; 1       MAL        H           25     TEMP W 1986-06-13 00:00:00 1986-06-13</span></span>
<span><span class="co">#&gt; 2       MAL        H           25     TEMP W 1986-06-13 01:00:00 1986-06-13</span></span>
<span><span class="co">#&gt; 3       MAL        H           25     TEMP W 1986-06-13 02:00:00 1986-06-13</span></span>
<span><span class="co">#&gt; 4       MAL        H           25     TEMP W 1986-06-13 03:00:00 1986-06-13</span></span>
<span><span class="co">#&gt; 5       MAL        H           25     TEMP W 1986-06-13 04:00:00 1986-06-13</span></span>
<span><span class="co">#&gt; 6       MAL        H           25     TEMP W 1986-06-13 05:00:00 1986-06-13</span></span>
<span><span class="co">#&gt;   value dataFlag units</span></span>
<span><span class="co">#&gt; 1    NA     &lt;NA&gt; DEG C</span></span>
<span><span class="co">#&gt; 2    NA     &lt;NA&gt; DEG C</span></span>
<span><span class="co">#&gt; 3    NA     &lt;NA&gt; DEG C</span></span>
<span><span class="co">#&gt; 4    NA     &lt;NA&gt; DEG C</span></span>
<span><span class="co">#&gt; 5    NA     &lt;NA&gt; DEG C</span></span>
<span><span class="co">#&gt; 6    NA     &lt;NA&gt; DEG C</span></span></code></pre></div>
<p>The function will provide the requested data directly into R if all the arguments are provided.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The <code>deltadata</code> package aims to provide workflow functions to efficiently work with IEP survey data. In this vignette, we explored how to use the package to replicate portions of the SLS QAQC pipeline. Function <code>bridgeAccess</code> is a convenient wrapper to connect to an Access database, allowing us to pull out relational tables of interest. The function can also access the relationship schema, which can be used to guide the joining process of our relational tables of interest via <code><a href="reference/schemaJoin.html">schemaJoin()</a></code>. Once these relational tables are read into R, we can leverage R packages to QAQC our data. The <code>deltadata</code> provides several niche QAQC functions: 1) <code><a href="reference/plotGPS.html">plotGPS()</a></code> and <code><a href="reference/gpsOutlier.html">gpsOutlier()</a></code> to explore outlying GPS coordinates based on the distance from the theoretical, and 2) compare water quality data to the nearest CDEC station via <code><a href="reference/popCDEC.html">popCDEC()</a></code>.</p>
<p>There may be additional functionalities added to this package in the future. If you have any suggestions or encounter any bugs, please feel free to open an <a href="https://github.com/trinhxuann/deltadata/issues" class="external-link">issue</a>, contribute to the package via a pull request, or directly contact <a href="mailto:trinh.nguyen@wildlife.ca.gov">Trinh Nguyen</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing deltadata</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Trinh Nguyen <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/YOUR-ORCID-ID" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Trinh Nguyen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
